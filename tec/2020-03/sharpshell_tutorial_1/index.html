<!doctype html><html class=no-js><head><base href=https://blog.acdzh.ltd/><script></script><title>从零开始的 .Net Shell 扩展教程 (一) - Shell 上下文菜单 - 串串的杂七杂八</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=description content="使用 .Net 快速创建 Shell 上下文菜单扩展."><meta name=author content="acdzh & dave kerr"><meta name=theme-color content="#c26d46"><meta name=publisher content="acdzh"><meta name=generator content="http://gohugo.io/"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><meta http-equiv=content-language content="zh-cn"><meta itemprop=name content="从零开始的 .Net Shell 扩展教程 (一) - Shell 上下文菜单 - 串串的杂七杂八"><meta itemprop=description content="使用 .Net 快速创建 Shell 上下文菜单扩展."><meta itemprop=image content="https://blog.acdzh.ltd/public/icons/png/avatar_512x512.png"><meta property="og:title" content="从零开始的 .Net Shell 扩展教程 (一) - Shell 上下文菜单 - 串串的杂七杂八"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/"><meta property="og:image" content="https://blog.acdzh.ltd/public/icons/png/avatar_512x512.png"><meta property="og:description" content="使用 .Net 快速创建 Shell 上下文菜单扩展."><meta name=twitter:card content="summary"><meta name=twitter:site content="@acdzh"><meta name=twitter:title content="从零开始的 .Net Shell 扩展教程 (一) - Shell 上下文菜单 - 串串的杂七杂八"><meta name=twitter:description content="使用 .Net 快速创建 Shell 上下文菜单扩展."><meta name=twitter:creator content="@acdzh & dave kerr"><meta name=twitter:image content="https://blog.acdzh.ltd/public/icons/png/avatar_512x512.png"><script>document.documentElement.className=document.documentElement.className.replace("no-js","js");</script><link rel=canonical href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/><link rel=shortlink href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/><link type=image/x-icon rel="shortcut icon" href=https://blog.acdzh.ltd/public/icons/png/avatar_64x64.png><script data-ad-client=ca-pub-7980517780099899 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link rel=stylesheet id=human-style-css href=https://blog.acdzh.ltd/wp-content/themes/hueman/style.css type=text/css media=all><link rel=stylesheet id=responsive-css href=https://blog.acdzh.ltd/wp-content/themes/hueman/responsive.css type=text/css media=all><link rel=stylesheet id=human-style-css2 href=https://blog.acdzh.ltd/wp-content/themes/hueman-child/style.css type=text/css media=all><link rel=stylesheet id=human-style-css3 href=https://blog.acdzh.ltd/wp-content/themes/hueman-child/user.css type=text/css media=all><link href=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.18.1/styles/github.min.css rel=stylesheet><script src=https://cdn.bootcdn.net/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><style>.blob-num,.hljs-toolbox{color:rgba(27,31,35,.3)}</style><link href=https://cdn.bootcdn.net/ajax/libs/font-awesome/5.13.0/css/all.min.css rel=stylesheet><link rel=stylesheet href=public/font/hack/css/hack.min.css><link rel=stylesheet href="https://fonts.loli.net/css2?family=Fira+Code&display=swap"><script src=https://cdn.bootcdn.net/ajax/libs/jquery/3.5.0/jquery.min.js></script><script src=https://cdn.bootcdn.net/ajax/libs/jquery.matchHeight/0.7.2/jquery.matchHeight-min.js></script><script src=https://cdn.bootcdn.net/ajax/libs/picturefill/3.0.3/picturefill.min.js></script><script type=text/javascript src=wp-content/themes/hueman/js/scripts.js></script><link rel=stylesheet id=custom-css href=assets/css/custom.css type=text/css media=all><script type=text/javascript async defer src=assets/js/myblog.js></script><script>if('serviceWorker'in navigator){navigator.serviceWorker.register('/assets/js/service-worker.js');}</script><link rel=manifest href=https://blog.acdzh.ltd/app.webmanifest><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-148601605-2','auto');ga('send','pageview');}</script></head><body class="single single-post single-format-standard col-3cm full-width topbar-enabled chrome"><div id=wrapper><header id=header><nav class="nav-container group" id=nav-topbar><div class=nav-toggle><i class="fas fa-bars"></i></div><div class=nav-text></div><div class="nav-wrap container"><a rel=nofollow href=https://blog.acdzh.ltd/ class=nav-cs-icon><img width=40 height=40 src=https://blog.acdzh.ltd/public/icons/png/avatar_512x512.png alt=acdzh title=Home></a><ul id=menu-default-menu class="nav container-inner group"><li class="menu-item menu-item-type-post_type menu-item-object-page"><a rel=nofollow href=https://blog.acdzh.ltd/><i class="fas fa-home"></i>&nbsp;&nbsp;首页</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E6%8A%80%E6%9C%AF/><i class="fas fa-gavel"></i>&nbsp;&nbsp;技术</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E9%97%B2%E8%AF%9D/><i class="fas fa-comment"></i>&nbsp;&nbsp;闲话</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a rel=nofollow href=https://blog.acdzh.ltd/others><i class="fas fa-tools"></i>&nbsp;&nbsp;其它</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a rel=nofollow href=https://blog.acdzh.ltd/post><i class="fas fa-archive"></i>&nbsp;&nbsp;归档</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a rel=nofollow href=https://blog.acdzh.ltd/about><i class="fas fa-user"></i>&nbsp;&nbsp;关于我</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page"></li><li class="menu-item menu-item-type-post_type menu-item-text">---0-0-0---</li></ul></div><div class=container><div class=container-inner><div class=toggle-search><i class="fas fa-search"></i></div><div class=search-expand><div class=search-expand-inner><form method=get class="searchform themeform" action=https://www.google.com/search><div><input type=text class=search name=q placeholder="Press enter to start searching"></div></form></div></div></div></div></nav><div class="container group"><div class=container-inner><div class="group pad"><div class="group pad"></div><h1 class=site-title><a rel=nofollow href=https://blog.acdzh.ltd rel=home><img id=title-avatar-img alt=acdzh src=https://blog.acdzh.ltd/public/icons/png/avatar_mask_512x512.png></img>
<span>串串的杂七杂八</span></a></h1><p class=site-description></p></div></div></div></div></header><div class=container id=page><div class=container-inner><div class=main><div class="main-inner group"><section class=content><div class="page-title pad group"><ul class="meta-single group"><div><li class=category><a href=https://blog.acdzh.ltd/categories/%E6%8A%80%E6%9C%AF/ rel="series category tag">技术</a></li><li class=category><a href=https://blog.acdzh.ltd/categories/CSharp/ rel="series category tag">CSharp</a></li><li class=category><a href=https://blog.acdzh.ltd/categories/Windows/ rel="series category tag">Windows</a></li></div><div style=float:right><li class=series><a href=https://blog.acdzh.ltd/series/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84-.Net-Shell-%E6%89%A9%E5%B1%95%E6%95%99%E7%A8%8B/ rel="series category tag">从零开始的 .Net Shell 扩展教程</a></li></div><div></div></ul></div><div class="pad group"><article class="post type-post status-publish format-standard has-post-thumbnail hentry category-australien tag-bondi-beach tag-city2surf tag-sydney"><div class="post-inner group"><h1 class=post-title>从零开始的 .Net Shell 扩展教程 (一) - Shell 上下文菜单</h1><p class=post-byline>By
acdzh & dave kerr
·
2020年03月07日 15:20 ·
4383 Words ·
~9min reading time
·
<span id=/tec/2020-03/sharpshell_tutorial_1/ class=leancloud_visitors data-flag-title="从零开始的 .Net Shell 扩展教程 (一) - Shell 上下文菜单"><span class=leancloud-visitors-count></span></span>Visitors
|
<a href=https://github.com/acdzh/hugo-blog-src/blob/master/content/tec/2020-03/1%20.NET%20Shell%20Extensions%20-%20Shell%20Context%20Menus.md target=_blank style=text-decoration:none>Raw on <i class="fab fa-github"></i></a></p><div class=clear></div><div class=entry><div class=entry-inner><p>使用 .Net 快速创建 Shell 上下文菜单扩展.</p><h2 id=介绍>介绍</h2><p>在 .NET 4.0 之前, 不可能使用 .NET 代码可靠地创建 Windows Shell 扩展. 通过对框架的改进, 现在可以使用 .NET 创建这些扩展. 在本文中, 我将向您展示如何快速将 Shell 上下文菜单创建为 C＃ 类库.</p><p><img src=../img/2020/03/07/195744.png alt=https://www.codeproject.com/KB/shell/512956/Screenshot8_SampleMenu.png></p><p><em><strong>上图是本文的一个例子, 这是一个Shell上下文菜单扩展- &ldquo;Count Lines&mldr;&rdquo;. 本文将使用这个例子来演示如何创建的自定义Shell扩展.</strong></em></p><h2 id=系列文章>系列文章</h2><p>本文是 &ldquo;.NET Shell扩展&rdquo; 系列的一部分，其中包括：</p><ol><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1>.NET Shell扩展-Shell 上下文菜单</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_2>.NET Shell扩展-Shell 图标处理程序</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_3>.NET Shell扩展-Shell 信息提示处理程序</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_4>.NET Shell扩展-Shell 拖拽处理程序</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_5>.NET Shell扩展-Shell 预览处理程序</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_6>.NET Shell扩展-Shell 图标叠加处理程序</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_7>.NET Shell扩展-Shell 缩略图处理程序</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_8>.NET Shell扩展-Shell 属性表</a></li><li><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_9>.NET Shell扩展-部署 SharpShell 服务</a></li></ol><h2 id=什么是-shell-上下文菜单>什么是 Shell 上下文菜单?</h2><p>Shell 上下文菜单是在系统中中注册的 COM servers, 它允许对 Shell 对象的上下文菜单进行扩展. 扩展的对象可以是特定的文件类型 (例如 *.txt 文件), 也可以是驱动器或者文件夹. 上下文菜单可以提供一些可以用 Windows 资源管理器进行快速访问的高级功能.</p><h2 id=入门>入门</h2><p>开发 Shell 扩展需要设计很多工作. 必须实现特定的 COM 接口, 必须构建服务器, 必须使用多种方式更新注册表. 我们将使用我开发的一个名为 <code>SharpShell</code> 的库来完成所有这些艰苦的工作, 我们所需要做的仅仅是创建一个轻量级类库, 它包含我们要实现的扩展类.</p><h2 id=我们的目标>我们的目标</h2><p>下面的代码创建了一个 Shell 扩展, 您可以通过右键单击任意文本文件并选择 &ldquo;计数行&rdquo; 来对统计其行数. 在本文的剩余部分, 我将向您展示如何创建这样的库. 之所以先展示这些代码, 是因为我想强调编写这些库到底有多么简单, 如果使用 <code>SharpShell</code> 的话.</p><pre><code class=language-csharp>/// &lt;summary&gt;
/// The CountLinesExtensions is an example shell context menu extension,
/// implemented with SharpShell. It adds the command 'Count Lines' to text
/// files.
/// &lt;/summary&gt;
[ComVisible(true)]
[COMServerAssociation(AssociationType.ClassOfExtension, &quot;.txt&quot;)]
public class CountLinesExtension : SharpContextMenu {
    /// &lt;summary&gt;
    /// Determines whether this instance can a shell
    /// context show menu, given the specified selected file list
    /// &lt;/summary&gt;
    /// &lt;returns&gt;
    /// &lt;c&gt;true&lt;/c&gt; if this instance should show a shell context
    /// menu for the specified file list; otherwise, &lt;c&gt;false&lt;/c&gt;
    /// &lt;/returns&gt;
    protected override bool CanShowMenu() {
        //  We always show the menu
        return true;
    }
 
    /// &lt;summary&gt;
    /// Creates the context menu. This can be a single menu item or a tree of them.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;
    /// The context menu for the shell context menu.
    /// &lt;/returns&gt;
    protected override ContextMenuStrip CreateMenu() {
        //  Create the menu strip
        var menu = new ContextMenuStrip();
 
        //  Create a 'count lines' item
        var itemCountLines = new ToolStripMenuItem {
            Text = &quot;Count Lines...&quot;,
            Image = Properties.Resources.CountLines
        };
 
        //  When we click, we'll count the lines
        itemCountLines.Click += (sender, args) =&gt; CountLines();
 
        //  Add the item to the context menu.
        menu.Items.Add(itemCountLines);
 
        //  Return the menu
        return menu;
    }
 
    /// &lt;summary&gt;
    /// Counts the lines in the selected files
    /// &lt;/summary&gt;
    private void CountLines() {
        //  Builder for the output
        var builder = new StringBuilder();
 
        //  Go through each file.
        foreach (var filePath in SelectedItemPaths) {
            //  Count the lines
            builder.AppendLine(string.Format(&quot;{0} - {1} Lines&quot;, 
              Path.GetFileName(filePath), File.ReadAllLines(filePath).Length));
        }
 
        //  Show the output
        MessageBox.Show(builder.ToString());
    }
}
</code></pre><p>代码非常干净, 实现起来也很简单. 现在让我们详细了解如何使用 <code>SharpShell</code> 来创建此 Shell 的上下文菜单.</p><h2 id=第一步-建立项目>第一步: 建立项目</h2><p>首先, 创建一个新的 C# 类库 (C# Class Library) 项目.</p><blockquote><p><strong>提示</strong>: 您可以使用 Visual Basic 而不是 C#. 虽然本文中的源代码是 C#, 但是创建 Visual Basic Shell 扩展的方法是相同的.</p></blockquote><p>在这个例子中, 我们将项目叫做 &lsquo;<code>CountLinesExtension</code>&rsquo;.</p><p>现在添加下列引用:</p><ol><li><code>System.WIndows.Forms</code></li><li><code>System.Drawing</code></li></ol><p><code>System.Windows.Forms</code> 是必需的, 因为我们将使用 Winforms <code>ContextMenuStrip</code> 来定义上下文菜单. 因为我们要使用图标, 因此 <code>System.Draeing</code> 也是必需的.</p><p>将 &lsquo;Class1.cs&rsquo; 文件重命名为 &lsquo;CountLinesExtension.cs&rsquo;. 现在, 我们的项目结构应该像下图一样:</p><p><img src=../img/2020/03/07/200451.png alt></p><blockquote><p><strong>译者注</strong>: 原文这里似乎确实缺了一张图, 此为译者补图. 另外关于此部分, 建议去看看第二篇文章的注释.</p></blockquote><h2 id=第二步-引用-sharpshell>第二步: 引用 SharpShell</h2><p>现在我们需要添加核心库 <code>SharpShell</code> 的引用. 您可以通过几种不同的方式进行此操作.</p><h3 id=添加引用>添加引用</h3><p>下载文章顶部名为 &ldquo;SharpShell Library&rdquo; 的 zip 文件, 并对下载的 SharpShell.dll 添加引用.</p><blockquote><p><strong>提示</strong>: 撰写本文时, 本文的下载是正确的. 如果需要最新版本, 请使用 Nuget (如下所述) 或从 <a href=http://sharpshell.codeplex.com/>sharpshell.codeplex.com</a>获取该库.</p></blockquote><h3 id=使用-nuget>使用 Nuget</h3><p>如果已安装 Nuget, 则只需要快速 SharpShell 并直接安装即可. 或者在<a href=https://www.nuget.org/packages/SharpShell>https://www.nuget.org/packages/SharpShell</a>中获取软件包的详细信息.</p><h3 id=使用-codeplex>使用 CodePlex</h3><p>该页面上的库可能不是最新版本, 但是您可以从 CodePlex 获取最新版本 - 在 SharpShell 的主页上: <a href=https://sharpshell.codeplex.com>https://sharpshell.codeplex.com</a>. Nuget 可以下载最新的稳定版本, 而 CodePlex 有可能有 beta 版本, 文章顶部的链接则是在撰写本是时测试通过的版本.</p><blockquote><p><strong>译者注</strong>: 这个项目的 CodePlex 主页已经停用了. 请前往 <a href=https://github.com/dwmkerr/sharpshell>Github 主页</a>查看最新版本.</p></blockquote><h2 id=第三步-从-sharpcontextmenu-继承-deriving-from-sharpcontextmenu>第三步: 从 SharpContextMenu 继承 (Deriving from SharpContextMenu)</h2><p>现在事情变得有趣了. 使你的类 <code>CountLinesExtension</code> 继承 <code>SharpContextMenu</code>:</p><pre><code class=language-csharp>/// &lt;summary&gt;
/// The Count Lines Context Menu Extension
/// &lt;/summary&gt;
public class CountLinesExtension : SharpContextMenu {

}
</code></pre><p>现在我们必须实现该类的抽象函数. 右键单击这一行的 <code>SharpContextMenu</code>, 然后选择 &ldquo;<strong>实现抽象类</strong>&rdquo; ('<strong>Implement Abstract Class</strong>')</p><blockquote><p><strong>译者注</strong>: 原文如此. 但在 VS 2019 中未找到此选项. 也可以通过在 <code>CountLinesExtension</code> 上按 <code>Alt</code> + <code>Enter</code>, 选择 &ldquo;实现抽象类&rdquo; 亦可. (当然自己不使用代码生成, 自己手动补全也是可以的</p></blockquote><p>这将创建所需的两个函数的实现 - <code>CanShowMenu</code> 和 <code>CreateMenu</code>:</p><pre><code class=language-csharp>/// &lt;summary&gt;
/// The Count Lines Context Menu Extension
/// &lt;/summary&gt;
public class CountLinesExtension : SharpContextMenu {
    protected override bool CanShowMenu() {
        throw new NotImplementedException();
    }
 
    protected override ContextMenuStrip CreateMenu() {
        throw new NotImplementedException();
    }
}
</code></pre><p>通过实现这两个方法, 我们可以提供所需的所有功能. 它们的作用如下:</p><h3 id=canshowmenu>CanShowMenu</h3><p>对于给定的文件扩展名集合, 通过调用此函数来确定我们是否显示其上下文菜单. 用户选择的文件在属性 <code>SelectedItemPaths</code> 中. 我们可以检查这些文件路径, 来判断我们是否需要显示菜单. 如果需要显示菜单, 返回 <code>true</code> , 否则返回 <code>false</code>.</p><h3 id=createmenu>CreateMenu</h3><p>这个函数会被调用, 来实际创建上下文菜单. 我们只需要返回一个标准 Winforms <code>ContextMenuStrip</code>.</p><p>这是我们对这两个方法的实现:</p><pre><code class=language-csharp>protected override bool CanShowMenu() {
    //  We will always show the menu
    return true;
}
 
protected override ContextMenuStrip CreateMenu() {
    //  Create the menu strip
    var menu = new ContextMenuStrip();
 
    //  Create a 'count lines' item
    var itemCountLines = new ToolStripMenuItem {
        Text = &quot;Count Lines&quot;
    };
 
    //  When we click, we'll call the 'CountLines' function
    itemCountLines.Click += (sender, args) =&gt; CountLines();
 
    //  Add the item to the context menu
    menu.Items.Add(itemCountLines);
 
    //  Return the menu
    return menu;
}
 
private void CountLines() {
    //  Builder for the output
    var builder = new StringBuilder();
 
    //  Go through each file
    foreach (var filePath in SelectedItemPaths) {
        //  Count the lines
        builder.AppendLine(string.Format(&quot;{0} - {1} Lines&quot;, 
          Path.GetFileName(filePath), File.ReadAllLines(filePath).Length));
    }
 
    //  Show the output
    MessageBox.Show(builder.ToString());
} 
</code></pre><p>对于 <code>CanShowMenu</code>, 我们总是返回 <code>true</code>, 我们不需要验证文件是否是文本文件, 并且很快就会看到这样做的原因. 对于 <code>CreateMenu</code>, 我们构造一个仅包含一项的上下文菜单条 (context menu strip), 它拥有标题 &lsquo;<strong>Count Lines</strong>&rsquo;, 并且调用 <code>CountLines</code> 函数.</p><p><code>CountLines</code> 函数遍历 <code>SelectedItemPaths</code>, 并计算每一个文件的行数, 之后再显示一个带有摘要的消息框 (MessageBox).</p><h2 id=第四步-处理-com-注册>第四步: 处理 COM 注册</h2><p>还有一些事情要做. 首先, 我们必须将 <code>COMVisible</code> 属性添加到我们的类中.</p><pre><code class=language-csharp>[ComVisible(true)]
public class CountLinesExtension : SharpContextMenu
</code></pre><p>为什么这么做? 好吧, 尽管我们的类看起来并不太像, 但它实际上确实是一个 COM 服务器 (COM server). 如果你去查看基类, 你将会看到, 我们在实现 COM 接口, 比如 <code>IShellExtInit</code>, <code>IContextMenu</code>, <code>ISharpShellServer</code>. 我们不必关心它们做什么, 但是为了系统能创建我们的扩展, 它必须要有此属性.</p><p>接下来, 我们必须给这个程序集一个强名称 (strong name). 有很多方式可以实现此需求, 不过我们有一个最好的方法. 为此, 我们需要在项目上单击鼠标右键, 然后点击 &ldquo;<strong>属性</strong>&rdquo;, 然后转到 &ldquo;<strong>签名</strong>&rdquo;, 选择 &ldquo;<strong>为程序集签名</strong>&rdquo;, 单击 &ldquo;<strong>选择强名称密钥文件</strong>&rdquo; 下的下拉列表, 选择 &ldquo;<strong>新建</strong>&rdquo;. 之后新建一个密钥, 您可以根据需要对密钥进行密码保护, 但这不是必需的.</p><p>最后一步, 我们需要将我们的扩展与一些文件类型关联. 我们可以通过 <code>COMServerAssociation</code> 属性 (由 SharpShell 提供) 来做到这一点:</p><pre><code class=language-csharp>[ComVisible(true)]
[COMServerAssociation(AssociationType.ClassOfExtension, &quot;.txt&quot;)]
public class CountLinesExtension : SharpContextMenu
</code></pre><p>那么, 我们在这一步都做了什么? 我们告诉 SharpShell 当注册这个服务时, 我们希望它与 *.txt 文件的<strong>类型</strong>进行关联. 这意味着, 我们不仅可以使其对任何文件名以 *.txt 结尾的文件有效, 同样对同类的文件同样有效. 从根本上来讲, 多数情况下, 这些文件与 *.txt 具有相同的图标.</p><blockquote><p><strong>译者注</strong>: 这一段直译过来有些拗口, 实际上原作者想表达的意思是, *.txt 文件的文件类型(Contene-Type)是 text/plain. 当我们让其与 *.txt 进行关联, 实际上是与 *.txt 的文件类型 text/plain 进行关联, 因此这个扩展不仅仅对 *.txt 有效, 同样对其他 text/plain 文件类型也有效</p></blockquote><p>您可以使用 <code>COMServerAssociation</code> 属性来做一些非常酷的事. 您可以将其与文件夹, 驱动器, 未知文件, 以及特定的扩展名相关联. 有关此功能的完整文档, 请访问<a href=http://sharpshell.codeplex.com/>SharpShell CodePlex</a>页面上的<a href="http://sharpshell.codeplex.com/wikipage?title=COM%20Server%20Associations&referringTitle=Documentation">COM 服务关联</a>.</p><blockquote><p><strong>译者注</strong>: 这个页面已经停止服务了. 文档请访问此 <a href=https://github.com/dwmkerr/sharpshell/blob/master/docs/com-server-associations.md>Github链接</a>.</p></blockquote><p>就这样, Build 该项目将创建 <code>CountLinesExtension</code> 程序集. 这个程序集可以作为一个 COM server 进行注册, 添加到系统的上下文菜单中. 为了注册这个 COM 服务器, 我们需要对其进行调试和部署. 我们将在下一节讨论细节.</p><h2 id=调试-shell-扩展>调试 Shell 扩展</h2><p>Shell 扩展程序会被托管在 Windows 资源管理器中. 因为 .Net COM 服务迂回的加载方式, 让调试器进入进程托管代码并逐步执行进行调试几乎是不可能的. 但是, 有一种方法可以快速调试扩展. <code>SharpShell</code>附带了一些工具, 能让 <code>SharpShell</code> COM 服务加载更简单一些, 其中之一就是 Server Manager. (SharpShell comes with some tools that make working with SharpShell COM servers a bit easier, and one of them is the Server Manager.) 我们可以使用此工具来 debug 我们的扩展.</p><p>打开 Server Manager, 然后使用 &lsquo;<strong>File</strong>&rsquo; > &lsquo;<strong>Load Server</strong>&rsquo; 来加载构建好的的 server 文件（DLL）. 您同样可以直接将 server 文件拖拽进主窗口. 选中这个 server , 右侧将会显示它的一些细节信息.</p><p>Server Manager 非常有用, 他可以告诉您, 这个 server 是否已经安装 (32 或者 64位模式), 以及其他的一些细节.</p><p>如果您加载了 <code>SharpContextMenu</code> server 并选中, 您可以打开 &lsquo;<strong>Tools</strong>&rsquo; 菜单, 选择 &lsquo;<strong>Test Context Menu</strong>&rsquo;.</p><p>当您使用 &lsquo;<strong>Test Context Menu</strong>&rsquo; 后, 您将获得一个 Test Shell 窗口. 这是一个 Windows 资源管理器的基本实现. 您可以在任意文件上右键来测试这个 Shell 上下文菜单.</p><p><strong>提示</strong>: 无论您设置了<strong>哪种 COMServerAssocations</strong>, Test Shell 都会尝试为所有项目创建上下文菜单.</p><p>将调试器附加到 <em>ServerManager.exe</em> 进程可以允许您调试您的上下文菜单并且进行测试, 而不必真正在 Windows 中注册. 这是当运行 Count Line 上下文菜单扩展时, TestShell 的样子:</p><p><img src=../img/2020/03/07/200549.png alt></p><p><img src=../img/2020/03/07/200609.png alt></p><blockquote><p><strong>译者注</strong>: 原文这里似乎确实又缺了一些图, 这两张图是我自己补上的</p></blockquote><h2 id=安装和注册-shell-扩展>安装和注册 Shell 扩展</h2><p>有多种安装和注册 SharpShell Shell 扩展的方法. 在本节中, 我将详细地介绍它们.</p><h3 id=the-regasm-tool>The regasm Tool</h3><p>您可以使用工具 &lsquo;regasm&rsquo; 来安装和注册 Shell 扩展. 使用 regasm 时, Shell 扩展将被安装至注册表中(COM Server 的 Class ID 将被放进 COM Server Class 部分中, 并与实际文件路径相关联), 这同样会注册文件类型关联.</p><h3 id=the-server-manager-tool>The Server Manager Tool</h3><p>Server Manager Tool 是我用来安装/卸载和注册/注销的首选方法, 至少在开发过程中如此. 因为它可以使你一键安装和注册. 它还可以让您指定是以 32 位还是以 64 位模式安装/卸载等.</p><h3 id=手动注册表操作>手动注册表操作</h3><p>通常, 这是一种不好的方法, 但是如果必须这样做的话, 则 Shell Extensions 的 MSDN 文档描述了一些必须对注册表进行的更改, 才能手动注册COM服务器或托管COM服务器. 该文档在 &ldquo;有用的资源&rdquo; 部分中列出.</p><h2 id=有用的资源>有用的资源</h2><ul><li><p><a href=http://msdn.microsoft.com/en-us/library/windows/desktop/cc144171.aspx>Creating Shortcut Menu Handlers in Windows</a>: 最重要的资源 - 有关 Shell 上下文菜单扩展如何在 Windows 中工作的详细信息.</p></li><li><p><a href=http://sharpshell.codeplex.com/>CodePlex上的SharpShell</a>: <code>SharpShell</code> 项目的所在地-包括文档，讨论以及最新的源代码和发行版. (译者注: 已迁移至 <a href=https://github.com/dwmkerr/sharpshell>Github</a>)</p></li></ul><h2 id=whats-next>What&rsquo;s Next?</h2><p>随着时间的推移, <code>SharpShell</code> 将提供一种使用 .Net 创建所有可用 Shell 扩展的机制. 目前已经实现了图标处理程序 (我正在处理文档), 并且实现了属性表处理程序 (Property Sheet Handlers)(仍需要解决一些错误). 每个扩展类型都会有一篇文章.</p><p>希望本文对您有所帮助. 对于功能请求, 错误或注释, 您可以使用下面的注释部分或CodePlex网站.</p><h2 id=历史>历史</h2><ul><li>2014年11月27日: 初始版本</li></ul><h2 id=license>License</h2><p>本文以及所有相关的源代码和文件均已获得 <a href=http://www.codeproject.com/info/cpol10.aspx>The Code Project Open License（CPOL）</a> 的许可.</p><h2 id=译注>译注</h2><ol><li><p>文章来源: <a href=https://www.codeproject.com/Articles/512956/NET-Shell-Extensions-Shell-Context-Menus>.NET Shell Extensions - Shell Context Menus - CodeProject</a></p></li><li><p>原文作者: Dave Kerr, A softer Developer from UK. His blog: <a href=http://www.dwmkerr.com/>www.dwmkerr.com</a>, Github: <a href=https://github.com/dwmkerr>dwmkerr@Github</a></p></li><li><p>本文最早发表于 <strong>2014年11月27日</strong>, 截至翻译时最新更新为 <strong>2019年6月29日</strong>, 翻译日期为 <strong>2020年3月6日</strong>. <strong>互联网日新月异, 请注意信息时效</strong>.</p></li><li><p>文中的代码均测试通过, 文中除了标有 &ldquo;译者注&rdquo; 的部分之外均为原文, 译者水平有限, 如有疑惑之处请戳原文或 PM 我, 谢谢茄子.</p></li><li><p>纠结了好久, 最终还是决定代码中的英文注释不翻译. 这部分与代码相关较大, 希望能尽量保持原汁原味.</p></li></ol><table><thead><tr><th align=center>Version</th><th align=center>Action</th><th align=center>Time</th></tr></thead><tbody><tr><td align=center>1.0</td><td align=center>Init</td><td align=center>2020-03-07 15:20</td></tr><tr><td align=center>1.0</td><td align=center>迁移至 blog</td><td align=center>2020-04-28 19:49</td></tr></tbody></table></div><div style="border:1px dashed #e0e0e0;padding:10px;background-color:#fffeee;background-repeat:no-repeat;background-attachment:scroll;background-position:1%;border-radius:6px;-moz-background-size:auto auto;-moz-background-clip:-moz-initial;-moz-background-origin:-moz-initial;-moz-background-inline-policy:-moz-initial"><div><p style=margin-top:0>作者：<a target=_blank href=https://blog.acdzh.ltd>acdzh</a><br>本文出处：<a target=_blank href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/>https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/</a><br>互联网日新月异，请注意文章时效。<br><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i><i class="fab fa-creative-commons-nc"></i><i class="fab fa-creative-commons-sa"></i></a>本作品采用 <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a> 进行许可。文章版权归作者所有，允许转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接，否则保留追究法律责任的权利。<br></p></div></div><div class=clear></div></div></div></article><div class=clear></div><p class=post-tags><i class="fas fa-folder-open"></i>&nbsp;
<a rel=category href=https://blog.acdzh.ltd/categories/%E6%8A%80%E6%9C%AF title="All posts in category 技术">技术</a>
<a rel=category href=https://blog.acdzh.ltd/categories/CSharp title="All posts in category CSharp">CSharp</a>
<a rel=category href=https://blog.acdzh.ltd/categories/Windows title="All posts in category Windows">Windows</a>
&nbsp;&nbsp;&nbsp;
<i class="fas fa-bookmark"></i>&nbsp;
<a rel=series href=https://blog.acdzh.ltd/series/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84-.Net-Shell-%E6%89%A9%E5%B1%95%E6%95%99%E7%A8%8B title="All posts in series 从零开始的 .Net Shell 扩展教程">从零开始的 .Net Shell 扩展教程</a>
&nbsp;&nbsp;&nbsp;
<i class="fas fa-tags"></i>&nbsp;
<a rel=tag href=https://blog.acdzh.ltd/tags/SharpShell title="All post with tag SharpShell">SharpShell</a>
<a rel=tag href=https://blog.acdzh.ltd/tags/CSharp title="All post with tag CSharp">CSharp</a>
<a rel=tag href=https://blog.acdzh.ltd/tags/Windows title="All post with tag Windows">Windows</a>
<a rel=tag href=https://blog.acdzh.ltd/tags/Windows-Shell title="All post with tag Windows Shell">Windows Shell</a></p><h4 class=heading><i class="fas fa-hand-point-right"></i>Related posts</h4><ul class="related-posts group"></ul><div id=valine_comments></div><script src=//unpkg.com/valine/dist/Valine.min.js></script><script>(function(){mapToObject=function(_this,func){const obj={};_this.forEach((item,index)=>{const result=func(item,index)||[];obj[result[0]]=result[1];});return obj;};const emojis={QQ:mapToObject(['aini','aixin','aoman','baiyan','bangbangtang','baojin','baoquan','bishi','bizui','cahan','caidao','chi','ciya','dabing','daku','dan','deyi','doge','fadai','fanu','fendou','ganga','gouyin','guzhang','haixiu','hanxiao','haobang','haqian','hecai','hexie','huaixiao','jie','jingkong','jingxi','jingya','juhua','keai','kelian','koubi','ku','kuaikule','kulou','kun','lanqiu','leiben','lenghan','liuhan','liulei','nanguo','OK','penxue','piezui','pijiu','qiang','qiaoda','qinqin','qiudale','quantou','saorao','se','shengli','shouqiang','shuai','shui','tiaopi','touxiao','tu','tuosai','weiqu','weixiao','woshou','wozuimei','wunai','xia','xiaojiujie','xiaoku','xiaoyanger','xieyanxiao','xigua','xu','yangtuo','yinxian','yiwen','youhengheng','youling','yun','zaijian','zhayanjian','zhemo','zhouma','zhuakuang','zuohengheng'],name=>[`qq_${name}`,`QQ/${name}.gif`]),'Tieba-New':mapToObject(['','10','100','101','102','103','104','105','106','107','108','109','11','110','111','112','113','114','115','116','117','118','119','12','120','121','122','123','124','13','14','15','16','17','18','19','2','20','21','22','23','24','25','26','27','28','29','3','30','31','32','33','34','35','36','37','38','39','4','40','41','42','43','44','45','46','47','48','49','5','50','6','66','67','68','69','7','70','71','72','73','74','75','76','77','78','79','8','80','81','82','83','84','85','86','87','88','89','9','90','91','92','93','94','95','96','97','98','99'],(name)=>[`tieba_${name}`,`Tieba-New/image_emoticon${name}.png`]),Coolapk:{...mapToObject(['100_qqdoge','1010','1011','1012','1013','1014','1015','1016','1017','1018','1019','101_pyjiaoyi','1020','1021','102_fadai','103_nb','104','105','106','107','108','109','10_aoman','11_yiwen','12_wuyu','13_huaixiao','14_bishi','15_fanu','16_tuosai','17_tushe','18_han','19_koubi','1_hahaha','20_qinqin','21_penxue','22_xiaoyan','23_shui','24_wuzuixiao','25_zaijian','26_kelian','27_qiang','28_ruo','29_baoquan','2_jingya','30_ok','31_xiaoku','32_heiha','33_wulian','34_jizhi','35_ye','36_ku','37_doge','38_wozuimei','39_caidao','3_ciya','40_aixin','41_meigui','42_diaoxie','43_heixian','44_pen','45_yinxian','46_nanguo','47_weiqu','48_weiweiyixiao','49_huanhu','4_liulei','50_xinsui','51_chigua','52_hejiu','53_pu','54_hongyaowan','55_lvyaowan','56_dogexiaoku','57_dogehechi','58_dogeyuanliangta','59_erha','5_keai','60_kuan','61_lvmao','62_huaji','63_liuhanhuaji','64_shounuehuaji','65_coshuaji','66_doujiyanhuaji','67_mojinghuaji','68','69','6_weixiao','70','71','72','73','74','75','76','77','78','79','7_hehe','80','81_naikezui','82_miaomiao','83_huoba','84_baiyan','85','86','87','88','89','8_piezui','90','91','92','93','94','95_erhading','96_kuanlvmao','97_haixiu','98_wunai','99_zhoumei','9_se'],name=>[`coolapk_${name.split('_')[0]}`,`Coolapk/coolapk_emotion_${name}.png`]),...mapToObject(['coolb','fived','fivef','fivem','fiveo','fivey','fy','oned','onef','onem','oneo','oney','oy','teny','twod','twof','twom','twoo','twoy','ty'],name=>[`coolapk_${name}`,`Coolapk/c_${name}.png`])},alu:mapToObject(['不出所料','不说话','不高兴','中刀','中指','中枪','亲亲','便便','内伤','击掌','口水','吐','吐舌','吐血倒地','呲牙','咽气','哭泣','喜极而泣','喷水','喷血','坐等','害羞','小眼睛','尴尬','得意','惊喜','想一想','愤怒','扇耳光','投降','抠鼻','抽烟','无奈','无所谓','无语','暗地观察','期待','欢呼','汗','深思','狂汗','献花','献黄瓜','皱眉','看不见','看热闹','瞅你','肿包','脸红','蜡烛','装大款','观察','赞一个','邪恶','锁眉','长草','阴暗','高兴','黑线','鼓掌'],(name,index)=>[`alu_${name}`,`alu/${name}.png`]),weibo:mapToObject(['d_aoteman','d_baibai','d_baobao','d_beishang','d_bingbujiandan','d_bishi','d_bizui','d_chanzui','d_chigua','d_chijing','d_dahaqi','d_dalian','d_ding','d_doge','d_erha','d_feijie','d_feizao','d_ganmao','d_guile','d_guzhang','d_haha','d_haixiu','d_han','d_hehe','d_heiheihei','d_heixian','d_heng','d_huaixiao','d_huaxin','d_jiyan','d_keai','d_kelian','d_ku','d_kulou','d_kun','d_landelini','d_lang','d_lei','d_miao','d_nanhaier','d_nu','d_numa','d_nvhaier','d_qian','d_qinqin','d_shayan','d_shengbing','d_shenshou','d_shiwang','d_shuai','d_shuijiao','d_sikao','d_taikaixin','d_tanshou','d_tian','d_touxiao','d_tu','d_tuzi','d_wabishi','d_weiqu','d_wu','d_xiaoku','d_xingxingyan','d_xiongmao','d_xixi','d_xu','d_yinxian','d_yiwen','d_youhengheng','d_yun','d_yunbei','d_zhuakuang','d_zhutou','d_zuiyou','emoji_0x1f31f','emoji_0x1f349','emoji_0x1f357','emoji_0x1f384','emoji_0x1f44f','emoji_0x1f47b','emoji_0x1f47f','emoji_0x1f48a','emoji_0x1f4a3','emoji_0x1f4a9','emoji_0x1f631','emoji_0x1f643','emoji_0x1f645','emoji_0x1f648','emoji_0x1f649','emoji_0x1f64a','emoji_0x1f64b','emoji_0x1f64f','emoji_0x1f913','emoji_0x1f917','emoji_0x26a1','h_buyao','h_good','h_haha','h_jiayou','h_lai','h_ok','h_quantou','h_ruo','h_woshou','h_ye','h_zan','h_zuoyi'],name=>[`weibo_${name}`,`weibo/${name}.png`]),lengtu:mapToObject([...new Array(48)],(_,index)=>[`lengtu_${index+1}`,`lengtu/${(index+1).toString().padStart(2,"0")}.gif`]),bilibili_2233:mapToObject(['卖萌','吃惊','吐魂','喝水','困惑','大哭','大笑','委屈','怒','无言','汗','疑问','第一','耶','郁闷'],(name,index)=>[`bili_2233_${name}`,`bilibili2233/[2233娘_${name}].png`]),bilibili_hotkey:mapToObject([...new Array(32)],(_,index)=>[`bili_hotkey_${index+1}`,`bilibiliHotKey/${(index+1)}.jpg`]),bilibili_tv:mapToObject(['doge','亲亲','偷笑','再见','冷漠','发怒','发财','可爱','吐血','呆','呕吐','困','坏笑','大佬','大哭','委屈','害羞','尴尬','微笑','思考','惊吓','打脸','抓狂','抠鼻','斜眼笑','无奈','晕','流汗','流泪','流鼻血','点赞','生气','生病','疑问','白眼','皱眉','目瞪口呆','睡着','笑哭','腼腆','色','调侃','调皮','鄙视','闭嘴','难过','馋','鬼脸','黑人问号','鼓掌'],(name,index)=>[`bili_tv_${name}`,`bilibilitv/[tv_${name}].png`]),aodamiao:mapToObject([...new Array(40)],(_,index)=>[`aodamiao_${index+1}`,`aodamiao/${(index+1).toString().padStart(2,"0")}.gif`]),'Cute-Emoji':mapToObject([...new Array(40)],(_,index)=>[`cute_emoji_${index+1}`,`Cute-Emoji/${(index+1).toString().padStart(3,"0")}.png`]),};new Valine({el:'#valine_comments',appId:'THSEEUpmt73ioQLUO7dO6sI8-9Nh9j0Va',appKey:'2ko493HrmEBiJ5FFTpPnnrWg',avatar:'robohash',visitor:true,recordIP:true,enableQQ:true,emojiCDN:'https://cdn.jsdelivr.net/gh/GamerNoTitle/ValineCDN@master/',emojiMaps:Object.assign({},...Object.keys(emojis).map(name=>emojis[name])),});})();</script></div></section><div class="sidebar s1"><a class=sidebar-toggle title="Expand Sidebar"><i class="fas fa-angle-right"></i></a><div class=sidebar-content><div class="sidebar-top group"><p>Catalog</p></div><div class=toc><div id=page-scrollspy class=toc-nav><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e4%bb%8b%e7%bb%8d title=介绍>介绍</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e7%b3%bb%e5%88%97%e6%96%87%e7%ab%a0 title=系列文章>系列文章</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e4%bb%80%e4%b9%88%e6%98%af-shell-%e4%b8%8a%e4%b8%8b%e6%96%87%e8%8f%9c%e5%8d%95 title="什么是 Shell 上下文菜单?">什么是 Shell 上下文菜单?</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e5%85%a5%e9%97%a8 title=入门>入门</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e6%88%91%e4%bb%ac%e7%9a%84%e7%9b%ae%e6%a0%87 title=我们的目标>我们的目标</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e7%ac%ac%e4%b8%80%e6%ad%a5-%e5%bb%ba%e7%ab%8b%e9%a1%b9%e7%9b%ae title="第一步: 建立项目">第一步: 建立项目</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e7%ac%ac%e4%ba%8c%e6%ad%a5-%e5%bc%95%e7%94%a8-sharpshell title="第二步: 引用 SharpShell">第二步: 引用 SharpShell</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e6%b7%bb%e5%8a%a0%e5%bc%95%e7%94%a8 title=添加引用>添加引用</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e4%bd%bf%e7%94%a8-nuget title="使用 Nuget">使用 Nuget</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e4%bd%bf%e7%94%a8-codeplex title="使用 CodePlex">使用 CodePlex</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e7%ac%ac%e4%b8%89%e6%ad%a5-%e4%bb%8e-sharpcontextmenu-%e7%bb%a7%e6%89%bf-deriving-from-sharpcontextmenu title="第三步: 从 SharpContextMenu 继承 (Deriving from SharpContextMenu)">第三步: 从 SharpContextMenu 继承 (Deriving from SharpContextMenu)</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#canshowmenu title=CanShowMenu>CanShowMenu</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#createmenu title=CreateMenu>CreateMenu</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e7%ac%ac%e5%9b%9b%e6%ad%a5-%e5%a4%84%e7%90%86-com-%e6%b3%a8%e5%86%8c title="第四步: 处理 COM 注册">第四步: 处理 COM 注册</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e8%b0%83%e8%af%95-shell-%e6%89%a9%e5%b1%95 title="调试 Shell 扩展">调试 Shell 扩展</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e5%ae%89%e8%a3%85%e5%92%8c%e6%b3%a8%e5%86%8c-shell-%e6%89%a9%e5%b1%95 title="安装和注册 Shell 扩展">安装和注册 Shell 扩展</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#the-regasm-tool title="The regasm Tool">The regasm Tool</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#the-server-manager-tool title="The Server Manager Tool">The Server Manager Tool</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e6%89%8b%e5%8a%a8%e6%b3%a8%e5%86%8c%e8%a1%a8%e6%93%8d%e4%bd%9c title=手动注册表操作>手动注册表操作</a></li></ul></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e6%9c%89%e7%94%a8%e7%9a%84%e8%b5%84%e6%ba%90 title=有用的资源>有用的资源</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#whats-next title="What’s Next?">What’s Next?</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e5%8e%86%e5%8f%b2 title=历史>历史</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#license title=License>License</a></li></ul></ul><ul class=nav-tabs><ul class=nav-tabs><li class=toc-nav-item><a class="toc-nav-link text-left" href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_1/#%e8%af%91%e6%b3%a8 title=译注>译注</a></li></ul></ul></div><script>$("#page-scrollspy a.toc-nav-link").on('click',function(){const navbarHeight=50;const scollOnePageTime=300;let target=decodeURI(this.hash.replace(/^#/,''));let scrollLength=$(":header[id='"+target+"']").offset().top-navbarHeight-50;let scrollTime=Math.max(Math.min(scrollLength*scollOnePageTime/window.innerHeight,800),300);$('html,body').animate({scrollTop:scrollLength},scrollTime);return false;});</script></div><ul class="post-nav group"><li class=next><a href=https://blog.acdzh.ltd/tec/2020-03/sharpshell_tutorial_2/ rel=next><i class="fas fa-chevron-right"></i><strong>Next post</strong>
<span>从零开始的 .Net Shell 扩展教程 (二) - Shell 图标处理程序 (Icon Handlers)</span></a></li><li class=previous><a href=https://blog.acdzh.ltd/tec/2020-03/%E4%BF%AE%E5%A4%8D%E9%93%BE%E6%96%AD%E8%A3%82%E7%9A%84%E8%99%9A%E6%8B%9F%E7%A3%81%E7%9B%98/ rel=prev><i class="fas fa-chevron-left"></i><strong>Previous Post</strong>
<span>修复链断裂的虚拟磁盘</span></a></li></ul><div id=search-2 class="widget widget_search"><h3>Search</h3><form method=get class="searchform themeform" action=https://www.google.com/search><div><input type=text class=search name=q placeholder="Press enter to start searching"></div></form></div></div></div><div class="sidebar s2"><a class=sidebar-toggle title="Expand Sidebar"><i class="fas fa-angle-left"></i></a><div class=sidebar-content><div class="sidebar-top group"><p>More</p></div><div id=categories-2 class="widget widget_categories"><h3><a rel=nofollow href=https://blog.acdzh.ltd/categories/><i class="fas fa-folder-open"></i>&nbsp;Categories</a></h3><ul><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/CSharp/>CSharp (6)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/Golang/>Golang (2)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/JavaScript/>JavaScript (2)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/Python/>Python (2)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/Windows/>Windows (9)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E5%89%8D%E7%AB%AF/>前端 (3)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/>嵌入式开发 (4)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E6%8A%80%E6%9C%AF/>技术 (28)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E7%88%AC%E8%99%AB/>爬虫 (2)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E7%A1%AC%E4%BB%B6/>硬件 (1)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E7%AE%97%E6%B3%95/>算法 (3)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/>软件工程 (4)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/categories/%E9%97%B2%E8%AF%9D/>闲话 (2)</a></li></ul></div><div id=series-2 class="widget widget_categories"><h3><a rel=nofollow href=https://blog.acdzh.ltd/series/><i class="fas fa-bookmark"></i>&nbsp;Series</a></h3><ul><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/series/Github-Organizations-%E6%8B%BC%E5%9B%BE/>Github-Organizations-拼图 (2)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/series/LeetCode-with-Golang/>LeetCode-with-Golang (2)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/series/UEFI-%E5%8E%9F%E7%90%86%E4%B8%8E%E7%BC%96%E7%A8%8B/>UEFI-原理与编程 (4)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/series/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84-.Net-Shell-%E6%89%A9%E5%B1%95%E6%95%99%E7%A8%8B/>从零开始的-.Net-Shell-扩展教程 (6)</a></li><li class="cat-item cat-item-1"><a rel=nofollow href=https://blog.acdzh.ltd/series/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E7%BB%8F%E6%B5%8E%E5%AD%A6%E7%AC%94%E8%AE%B0/>软件工程经济学笔记 (4)</a></li></ul><style>#series-2>ul>li a:before{content:'\f02e'}</style></div><div id=tags-2 class=widget><h3><a rel=nofollow href=https://blog.acdzh.ltd/tags/><i class="fas fa-tags"></i>&nbsp;tags</a></h3><p class=post-tags><a href=tags/CSS><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>CSS</a>
<a href=tags/CSharp><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>CSharp</a>
<a href=tags/EDK2><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>EDK2</a>
<a href=tags/Express><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Express</a>
<a href=tags/Github><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Github</a>
<a href=tags/Golang><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Golang</a>
<a href=tags/Hyper-V><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Hyper-V</a>
<a href=tags/IEEE-1588><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>IEEE-1588</a>
<a href=tags/JavaScript><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>JavaScript</a>
<a href=tags/Javascript><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Javascript</a>
<a href=tags/Jupyter-Notebook><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Jupyter-Notebook</a>
<a href=tags/KOA><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>KOA</a>
<a href=tags/Kori><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Kori</a>
<a href=tags/LeetCode><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>LeetCode</a>
<a href=tags/Leetcode><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Leetcode</a>
<a href=tags/Node><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Node</a>
<a href=tags/OpenCV><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>OpenCV</a>
<a href=tags/PIL><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>PIL</a>
<a href=tags/PTP><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>PTP</a>
<a href=tags/Python><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Python</a>
<a href=tags/SharpShell><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>SharpShell</a>
<a href=tags/UEFI><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>UEFI</a>
<a href=tags/Wallpaper-Engine><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Wallpaper-Engine</a>
<a href=tags/Windows><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Windows</a>
<a href=tags/Windows-Shell><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>Windows-Shell</a>
<a href=tags/blog><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>blog</a>
<a href=tags/npm><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>npm</a>
<a href=tags/%E5%B5%8C%E5%85%A5%E5%BC%8F><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>嵌入式</a>
<a href=tags/%E7%88%AC%E8%99%AB><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>爬虫</a>
<a href=tags/%E7%A1%AC%E4%BB%B6><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>硬件</a>
<a href=tags/%E7%AC%94%E8%AE%B0><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>笔记</a>
<a href=tags/%E7%BB%8F%E6%B5%8E%E5%AD%A6><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>经济学</a>
<a href=tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>编译原理</a>
<a href=tags/%E8%AE%BA%E6%96%87><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>论文</a>
<a href=tags/%E8%AF%BE%E7%A8%8B><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>课程</a>
<a href=tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B><i class="fas fa-tag" style="color:#ccc;margin:0 6px 0 -6px"></i>软件工程</a></p></div></div></div></div></div></div></div><footer id=footer><section class=container id=footer-bottom><div class=container-inner><a id=back-to-top href=#><i class="fas fa-angle-up"></i></a><div class="pad group"><div class="grid one-half"><div id=copyright style=font-size:1.1rem><p>Copyright (c) 2020. All rights reserved.<p style=margin-top:8px>Power by
<a rel=nofollow href=http://gohugo.io/ target=_blank>Hugo 0.73.0</a>,
<a rel=nofollow href=http://golang.org target=_blank>Golang</a>.
Theme <a rel=nofolloe href=https://github.com/acdzh/hugo-theme-rapid target=_blank>rapid</a>.</p></p></div></div><div class="grid one-half last"><div id=social-links><a href=//github.com/acdzh/ target=_blank rel=noopener title="fork me on github"><i class="fab fa-github" aria-disabled></i></a><a href=//steamcommunity.com/id/acdzh/ target=_blank rel=noopener title="play games with me"><i class="fab fa-steam" aria-disabled></i></a><a href=mailto:acdzh@outlook.com target=_blank rel=noopener title=Mail><i class="far fa-envelope" aria-disabled></i></a><a href="tencent://message/?uin=57082212&Site=1069436872&Menu=yes" target=_blank rel=noopener title=QQ><i class="fab fa-qq" aria-disabled></i></a><a href=//zhihu.com/people/kkkk-zzzz-13 target=_blank rel=noopener title=知乎><i class="fab fa-zhihu" aria-disabled></i></a><div style=font-size:1.1rem;margin-top:10px><a href=//zhuanlan.zhihu.com/c_1159869906471759872 target=_blank rel=noopener title=知乎专栏>zhuanlan</a>
<a href=//cnblogs.com/acdzh target=_blank rel=noopener title=博客园>cnblogs</a></div></div><style>#social-links{text-align:right;font-size:1.5rem;color:#fff}@media only screen and (max-width:719px){#social-links{margin-top:10px;text-align:center}}</style></div></div></div></section></footer></div></body></html>